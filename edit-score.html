<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿®æ”¹åˆ†æ•° - å­¦ä¹ åŠ©æ‰‹</title>
    <link rel="manifest" href="manifest-b.json">
    <link rel="stylesheet" href="style.css">
    <meta name="theme-color" content="#f39c12">
    <script>
        document.documentElement.setAttribute('data-page', 'edit');
    </script>
</head>
<body>
    <div class="container">
        <h1>âœï¸ ä¿®æ”¹åˆ†æ•°</h1>
        
        <div class="current-score">
            <p>å½“å‰åˆ†æ•°: <span id="currentScore" class="current-score-value">0</span> åˆ†</p>
            <p id="currentTime" class="time-text"></p>
        </div>
        
        <div class="score-input">
            <div class="input-group">
                <input type="number" id="scoreInput" placeholder="è¾“å…¥0-100ä¹‹é—´çš„åˆ†æ•°" min="0" max="100">
                <button id="updateBtn" class="update-btn">æ›´æ–°åˆ†æ•°</button>
            </div>
            
            <div class="quick-actions">
                <button class="quick-btn" data-action="plus5">+5åˆ†</button>
                <button class="quick-btn" data-action="minus5">-5åˆ†</button>
                <button class="quick-btn" data-action="reset">é‡ç½®ä¸º0</button>
            </div>
        </div>
        
        <div class="history-section">
            <h3>ğŸ“ ä¿®æ”¹è®°å½•</h3>
            <div id="historyList" class="history-list"></div>
        </div>
        
        <p class="hint-text">è¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹é¡µé¢ï¼Œæ— æ³•æŸ¥çœ‹æœ€æ–°åˆ†æ•°</p>
    </div>
    
    <script>
        // 1. æ˜¾ç¤ºå½“å‰åˆ†æ•°
        function showCurrentScore() {
            const score = localStorage.getItem('study_score') || '0';
            const time = localStorage.getItem('study_score_updated') || '';
            
            document.getElementById('currentScore').textContent = score;
            document.getElementById('currentTime').textContent = time ? `æ›´æ–°æ—¶é—´: ${time}` : '';
        }
        
        // 2. æ˜¾ç¤ºå†å²è®°å½•
        function showHistory() {
            const history = JSON.parse(localStorage.getItem('score_history') || '[]');
            const historyList = document.getElementById('historyList');
            
            if (history.length === 0) {
                historyList.innerHTML = '<p class="no-history">æš‚æ— ä¿®æ”¹è®°å½•</p>';
                return;
            }
            
            let html = '';
            history.slice(0, 5).forEach(item => { // åªæ˜¾ç¤ºæœ€è¿‘5æ¡
                html += `<div class="history-item">
                    <span class="history-score">${item.score}åˆ†</span>
                    <span class="history-time">${item.time}</span>
                </div>`;
            });
            
            historyList.innerHTML = html;
        }
        
        // 3. ä¿å­˜åˆ†æ•°å’Œå†å²è®°å½•
        function saveScore(newScore) {
            const now = new Date();
            const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            const dateStr = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`;
            const fullTime = `${dateStr} ${timeStr}`;
            
            // ä¿å­˜å½“å‰åˆ†æ•°
            localStorage.setItem('study_score', newScore);
            localStorage.setItem('study_score_updated', fullTime);
            
            // ä¿å­˜å†å²è®°å½•
            let history = JSON.parse(localStorage.getItem('score_history') || '[]');
            history.unshift({ // æ·»åŠ åˆ°å¼€å¤´
                score: newScore,
                time: fullTime
            });
            
            // åªä¿ç•™æœ€è¿‘20æ¡è®°å½•
            if (history.length > 20) {
                history = history.slice(0, 20);
            }
            
            localStorage.setItem('score_history', JSON.stringify(history));
            
            // è§¦å‘storageäº‹ä»¶ï¼Œè®©Aé¡µé¢è‡ªåŠ¨åˆ·æ–°
            window.dispatchEvent(new StorageEvent('storage', {
                key: 'study_score',
                newValue: newScore
            }));
            
            return fullTime;
        }
        
        // 4. æ›´æ–°åˆ†æ•°
        function updateScore(newScore) {
            const scoreNum = parseInt(newScore);
            if (isNaN(scoreNum) || scoreNum < 0 || scoreNum > 100) {
                alert('è¯·è¾“å…¥0-100ä¹‹é—´çš„æœ‰æ•ˆåˆ†æ•°');
                return false;
            }
            
            const time = saveScore(newScore.toString());
            
            alert(`âœ… åˆ†æ•°å·²æ›´æ–°ä¸º: ${newScore} åˆ†\næ›´æ–°æ—¶é—´: ${time}`);
            document.getElementById('scoreInput').value = '';
            showCurrentScore();
            showHistory();
            
            return true;
        }
        
        // 5. å¿«é€Ÿæ“ä½œ
        function quickAction(action) {
            let currentScore = parseInt(localStorage.getItem('study_score') || '0');
            
            switch(action) {
                case 'plus5':
                    currentScore = Math.min(100, currentScore + 5);
                    break;
                case 'minus5':
                    currentScore = Math.max(0, currentScore - 5);
                    break;
                case 'reset':
                    currentScore = 0;
                    break;
            }
            
            updateScore(currentScore.toString());
        }
        
        // 6. é¡µé¢åŠ è½½
        document.addEventListener('DOMContentLoaded', function() {
            showCurrentScore();
            showHistory();
            
            // æ›´æ–°æŒ‰é’®
            document.getElementById('updateBtn').addEventListener('click', function() {
                const input = document.getElementById('scoreInput');
                updateScore(input.value.trim());
            });
            
            // Enteré”®æäº¤
            document.getElementById('scoreInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    updateScore(this.value.trim());
                }
            });
            
            // å¿«é€Ÿæ“ä½œæŒ‰é’®
            document.querySelectorAll('.quick-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    quickAction(this.dataset.action);
                });
            });
        });
        
        // 7. å®‰è£…åˆ°æ¡Œé¢åŠŸèƒ½
        let installPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            installPrompt = e;
        });
    </script>
</body>
</html>